<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Signal Pro V8 (Forex+Crypto)</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .glass { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-card { background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9)); border: 1px solid rgba(255, 255, 255, 0.05); }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .active-coin { border-color: #3b82f6; background: rgba(59, 130, 246, 0.15); }
        .active-coin-forex { border-color: #eab308; background: rgba(234, 179, 8, 0.15); }
        .active-nav { color: #3b82f6; }
        .active-risk { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.2); color: white; }
        .spin-anim { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 px-5 py-4 flex justify-between items-center bg-slate-900/90 backdrop-blur-md">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fa-solid fa-robot text-white text-sm"></i>
            </div>
            <h1 class="font-bold text-lg">AI Signal<span class="text-blue-500">Pro</span></h1>
        </div>
        <div class="text-[10px] font-mono text-gray-400" id="clock">00:00</div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto pt-20 pb-24 px-4 hide-scroll relative">

        <!-- VIEW 1: DASHBOARD -->
        <div id="view-dashboard" class="view-section">
            <!-- Coin List -->
            <div id="coinList" class="flex gap-3 overflow-x-auto hide-scroll pb-4 mb-2"></div>

            <!-- Analysis Card -->
            <div class="glass-card rounded-3xl p-1 relative overflow-hidden shadow-2xl transition-all duration-300" id="mainCard">
                <div class="relative bg-slate-900/40 rounded-[20px] p-5">
                    
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <div class="flex items-center gap-2">
                                <h2 id="pairName" class="text-3xl font-bold text-white tracking-tight">BTC/USDT</h2>
                                <span id="assetTypeBadge" class="text-[9px] px-2 py-0.5 rounded bg-gray-700 text-gray-300 font-bold uppercase">CRYPTO</span>
                            </div>
                            <p id="currentPrice" class="font-mono text-xl text-blue-400 mt-1">$0.00</p>
                        </div>
                        <div id="biasBadge" class="px-4 py-2 rounded-xl bg-gray-800 border border-gray-700 flex flex-col items-center">
                            <span class="text-[10px] text-gray-400 font-bold mb-1">SIGNAL</span>
                            <span id="biasText" class="font-bold text-sm text-gray-300">WAITING</span>
                        </div>
                    </div>

                    <!-- TF Selector -->
                    <div class="flex justify-between bg-slate-950/50 p-1 rounded-xl mb-6 overflow-x-auto hide-scroll gap-1">
                        <button onclick="setTF('1d')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-1d">1D</button>
                        <button onclick="setTF('4h')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-4h">4H</button>
                        <button onclick="setTF('1h')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-1h">1H</button>
                        <button onclick="setTF('30m')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-30m">30M</button>
                        <button onclick="setTF('15m')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors active-risk" id="btn-15m">15M</button>
                        <button onclick="setTF('5m')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-5m">5M</button>
                        <button onclick="setTF('1m')" class="tf-btn flex-1 min-w-[40px] py-2 text-xs font-bold rounded-lg text-gray-500 transition-colors" id="btn-1m">1M</button>
                    </div>

                    <!-- Setup Grid -->
                    <div id="setupGrid" class="space-y-3 transition-all duration-300">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-slate-800/50 rounded-2xl p-4 border border-slate-700/50">
                                <span class="text-[10px] font-bold text-gray-400 uppercase block mb-1">Entry</span>
                                <p id="entryPrice" class="font-mono text-white font-bold text-sm">---</p>
                            </div>
                            <div class="bg-red-500/10 rounded-2xl p-4 border border-red-500/20">
                                <span class="text-[10px] font-bold text-red-400 uppercase block mb-1">Stop Loss</span>
                                <p id="slPrice" class="font-mono text-red-400 font-bold text-sm">---</p>
                            </div>
                        </div>
                        <div class="bg-slate-800/50 rounded-2xl p-4 border border-slate-700/50 space-y-3">
                            <div class="flex justify-between"><span class="text-xs text-green-500 font-bold">TP 1</span><span id="tp1Price" class="font-mono font-bold text-sm">---</span></div>
                            <div class="flex justify-between"><span class="text-xs text-green-500 font-bold">TP 2</span><span id="tp2Price" class="font-mono font-bold text-sm">---</span></div>
                            <div class="flex justify-between"><span class="text-xs text-green-500 font-bold">TP 3</span><span id="tp3Price" class="font-mono font-bold text-sm">---</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Bar -->
            <div class="flex justify-between items-center px-4 mt-4">
                <div class="text-xs font-bold text-gray-400">RSI (14): <span id="rsiValue" class="text-white">--</span></div>
                <div class="text-xs font-bold text-gray-400">Trend: <span id="trendValue" class="text-white">--</span></div>
            </div>

            <button onclick="analyzeMarket(true)" id="refreshBtn" class="w-full mt-4 py-3 rounded-xl bg-slate-800 border border-slate-700 text-sm font-bold text-gray-300 active:scale-95 transition-all flex items-center justify-center gap-2 hover:bg-slate-700 shadow-lg">
                <i class="fa-solid fa-rotate" id="refreshIcon"></i> Refresh Analysis
            </button>
        </div>

        <!-- VIEW 2: PATTERNS -->
        <div id="view-patterns" class="view-section hidden">
            <h2 class="text-xl font-bold mb-4 px-2">Scanner (Forex & Crypto)</h2>
            <div id="scannerList" class="space-y-3">
                <div class="text-center py-10 text-gray-500 animate-pulse">Scanning Markets...</div>
            </div>
            <button onclick="runScanner()" class="w-full mt-6 py-3 rounded-xl bg-blue-600 text-sm font-bold shadow-lg shadow-blue-600/30">
                <i class="fa-solid fa-radar mr-2"></i> Refresh Scanner
            </button>
        </div>

        <!-- VIEW 3: SETTINGS -->
        <div id="view-settings" class="view-section hidden">
            <h2 class="text-xl font-bold mb-6 px-2">Settings</h2>
            <div class="bg-slate-800/50 rounded-2xl p-5 border border-slate-700 mb-6">
                <h3 class="font-bold text-sm mb-4">Risk Appetite</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setRisk('conservative')" id="risk-conservative" class="risk-btn py-3 rounded-xl border border-gray-600 text-xs font-bold text-gray-400 bg-slate-900">Safe</button>
                    <button onclick="setRisk('standard')" id="risk-standard" class="risk-btn py-3 rounded-xl border border-blue-500 bg-blue-500/20 text-xs font-bold text-white active-risk">Normal</button>
                    <button onclick="setRisk('aggressive')" id="risk-aggressive" class="risk-btn py-3 rounded-xl border border-gray-600 text-xs font-bold text-gray-400 bg-slate-900">Degen</button>
                </div>
            </div>
            <div class="bg-slate-800/50 rounded-2xl p-5 border border-slate-700">
                <h3 class="font-bold text-sm mb-2">System Info</h3>
                <p class="text-xs text-gray-400">Note: Forex data is approximated using Binance Stablecoin pairs (PAXG/USDT for Gold, EUR/USDT for Euro).</p>
                
                <!-- DISCLAIMER RESTORED -->
             <div class="mt-4 pt-2 border-t border-gray-700">
                    <div class="bg-red-900/20 border border-red-900/50 rounded-xl p-3 mt-2">
                        <p class="text-[10px] text-gray-300 leading-relaxed text-justify">
                            <strong class="text-red-400 block mb-1 uppercase">⚠️ Legal Disclaimer</strong>
                            This application is developed strictly for <strong>educational purposes only</strong>. Nothing contained herein constitutes financial, investment, or legal advice. Cryptocurrency trading involves high risk. Always <strong>Do Your Own Research (DYOR)</strong> before making any financial decisions. The creator (Shafiq Mustapa) assumes no responsibility or liability for any errors, omissions, or any outcomes related to the use of this application.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- GLOBAL FOOTER -->
        <div class="mt-12 text-center pb-8">
            <a href="https://wa.me/60127277015?text=crypto%20signal" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-800 rounded-full border border-slate-700 hover:border-blue-500 transition-colors group">
                <i class="fa-brands fa-whatsapp text-green-500 text-lg group-hover:scale-110 transition-transform"></i>
                <span class="text-xs text-gray-400 group-hover:text-white">Made in Skudai ❤️ - <span class="font-bold text-blue-400">Shafiq Mustapa</span></span>
            </a>
        </div>
    </main>

    <!-- Bottom Nav -->
    <nav class="glass fixed bottom-0 w-full pb-safe">
        <div class="flex justify-around items-center p-2">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn flex flex-col items-center gap-1 p-2 w-16 active-nav"><i class="fa-solid fa-chart-pie text-xl"></i><span class="text-[9px] font-bold">Signal</span></button>
            <button onclick="switchTab('patterns')" id="nav-patterns" class="nav-btn flex flex-col items-center gap-1 text-gray-500 p-2 w-16"><i class="fa-solid fa-list-check text-xl"></i><span class="text-[9px] font-bold">Scanner</span></button>
            <button onclick="switchTab('settings')" id="nav-settings" class="nav-btn flex flex-col items-center gap-1 text-gray-500 p-2 w-16"><i class="fa-solid fa-sliders text-xl"></i><span class="text-[9px] font-bold">Settings</span></button>
        </div>
    </nav>

    <script>
        // CONFIG - Added Forex Pairs via Proxy (PAXG = Gold, EUR = Euro)
        const COINS = [
            {symbol: 'PAXGUSDT', name: 'GOLD (XAU)', type: 'forex'}, // Gold Wrapper
            {symbol: 'EURUSDT', name: 'EURO (EUR)', type: 'forex'},  // Euro Wrapper
            {symbol: 'BTCUSDT', name: 'Bitcoin', type: 'crypto'},
            {symbol: 'ETHUSDT', name: 'Ethereum', type: 'crypto'},
            {symbol: 'SOLUSDT', name: 'Solana', type: 'crypto'},
            {symbol: 'BNBUSDT', name: 'BNB', type: 'crypto'},
            {symbol: 'XRPUSDT', name: 'Ripple', type: 'crypto'}
        ];

        let state = { currentSymbol: 'BTCUSDT', currentName: 'Bitcoin', currentType: 'crypto', tf: '15m', riskMultiplier: 1.5, riskName: 'Standard', riskMode: 'standard' };

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings(); renderCoinList(); analyzeMarket(); startClock();
        });

        function startClock() {
            setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}); }, 1000);
        }

        // --- CORE ALGORITHMS ---
        function calculateRSI(prices, period = 14) {
            let gains = 0, losses = 0;
            for (let i = 1; i <= period; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff >= 0) gains += diff; else losses += Math.abs(diff);
            }
            let avgGain = gains / period; let avgLoss = losses / period;
            for (let i = period + 1; i < prices.length; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff >= 0) { avgGain = (avgGain * (period - 1) + diff) / period; avgLoss = (avgLoss * (period - 1) + 0) / period; } 
                else { avgGain = (avgGain * (period - 1) + 0) / period; avgLoss = (avgLoss * (period - 1) + Math.abs(diff)) / period; }
            }
            const rs = avgGain / avgLoss; return 100 - (100 / (1 + rs));
        }

        function calculateLogic(candles) {
            const closes = candles.map(c => c.close);
            const current = closes[closes.length - 1];
            
            let sum = 0; for(let i=candles.length-21; i<candles.length-1; i++) sum += candles[i].close;
            const sma = sum / 20;

            const rsi = calculateRSI(closes, 14);

            let trSum = 0; for(let i=candles.length-15; i<candles.length-1; i++) trSum += (candles[i].high - candles[i].low);
            const atr = trSum / 14;

            const isTrendUp = current > sma;
            let signalType = 'NEUTRAL'; let signalStrength = 'WAIT';

            if (isTrendUp) {
                if (rsi < 70) { signalType = 'BULLISH'; signalStrength = 'STRONG BUY'; }
                else { signalType = 'BULLISH'; signalStrength = 'WEAK BUY (Overbought)'; }
            } else {
                if (rsi > 30) { signalType = 'BEARISH'; signalStrength = 'STRONG SELL'; }
                else { signalType = 'BEARISH'; signalStrength = 'WEAK SELL (Oversold)'; }
            }

            const range = atr * state.riskMultiplier;
            let entry = current; let sl, tp1, tp2, tp3;

            if(signalType === 'BULLISH') {
                sl = current - range; tp1 = current + range; tp2 = current + (range * 2); tp3 = current + (range * 3);
            } else {
                sl = current + range; tp1 = current - range; tp2 = current - (range * 2); tp3 = current - (range * 3);
            }

            return { type: signalType, strength: signalStrength, price: current, entry, sl, tp1, tp2, tp3, rsi, isTrendUp };
        }

        // --- UI UPDATERS ---
        async function analyzeMarket(manual = false) {
            if(manual) document.getElementById('refreshIcon').classList.add('spin-anim');
            document.getElementById('biasText').innerText = "CALC...";
            document.getElementById('mainCard').classList.add('opacity-70');

            try {
                const data = await fetchCandles(state.currentSymbol, state.tf);
                const signal = calculateLogic(data);
                
                // Update Name & Badge
                document.getElementById('pairName').innerText = state.currentName;
                const typeBadge = document.getElementById('assetTypeBadge');
                typeBadge.innerText = state.currentType;
                typeBadge.className = state.currentType === 'forex' 
                    ? "text-[9px] px-2 py-0.5 rounded bg-yellow-600/20 text-yellow-400 font-bold uppercase border border-yellow-600/30"
                    : "text-[9px] px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 font-bold uppercase border border-blue-600/30";

                const badge = document.getElementById('biasBadge');
                const txt = document.getElementById('biasText');
                
                if(signal.type === 'BULLISH') {
                    badge.className = "px-4 py-2 rounded-xl bg-green-500/10 border border-green-500/30 flex flex-col items-center min-w-[100px]";
                    txt.className = "font-bold text-sm text-green-400";
                    txt.innerHTML = signal.strength.includes('STRONG') ? '<i class="fa-solid fa-rocket"></i> STRONG BUY' : '<i class="fa-solid fa-triangle-exclamation"></i> WEAK BUY';
                } else {
                    badge.className = "px-4 py-2 rounded-xl bg-red-500/10 border border-red-500/30 flex flex-col items-center min-w-[100px]";
                    txt.className = "font-bold text-sm text-red-400";
                    txt.innerHTML = signal.strength.includes('STRONG') ? '<i class="fa-solid fa-dumpster-fire"></i> STRONG SELL' : '<i class="fa-solid fa-triangle-exclamation"></i> WEAK SELL';
                }

                document.getElementById('rsiValue').innerText = signal.rsi.toFixed(1);
                document.getElementById('rsiValue').className = signal.rsi > 70 ? 'text-red-400 font-bold' : (signal.rsi < 30 ? 'text-green-400 font-bold' : 'text-white');
                document.getElementById('trendValue').innerText = signal.isTrendUp ? 'UPTREND' : 'DOWNTREND';
                document.getElementById('trendValue').className = signal.isTrendUp ? 'text-green-400' : 'text-red-400';

                // Price Formatting (Auto-detect decimals)
                const decimals = signal.price < 2 ? 4 : 2; // Forex pairs like Euro need 4 decimals
                const fmt = n => '$' + n.toFixed(decimals);

                document.getElementById('currentPrice').innerText = fmt(signal.price);
                document.getElementById('entryPrice').innerText = fmt(signal.entry);
                document.getElementById('slPrice').innerText = fmt(signal.sl);
                document.getElementById('tp1Price').innerText = fmt(signal.tp1);
                document.getElementById('tp2Price').innerText = fmt(signal.tp2);
                document.getElementById('tp3Price').innerText = fmt(signal.tp3);

            } catch (e) { console.error(e); } 
            finally { 
                setTimeout(() => {
                    document.getElementById('refreshIcon').classList.remove('spin-anim');
                    document.getElementById('mainCard').classList.remove('opacity-70');
                }, 500);
            }
        }

        async function runScanner() {
            const list = document.getElementById('scannerList');
            list.innerHTML = '<div class="text-center py-4"><i class="fa-solid fa-circle-notch fa-spin text-blue-500"></i> Scanning...</div>';
            let html = '';
            for (const coin of COINS) {
                try {
                    const data = await fetchCandles(coin.symbol, '15m'); 
                    const signal = calculateLogic(data);
                    const color = signal.type === 'BULLISH' ? 'text-green-400' : 'text-red-400';
                    const bg = signal.type === 'BULLISH' ? 'bg-green-500/10 border-green-500/20' : 'bg-red-500/10 border-red-500/20';
                    
                    // Forex styling
                    const nameColor = coin.type === 'forex' ? 'text-yellow-400' : 'text-white';
                    
                    html += `<div class="flex justify-between items-center p-3 rounded-xl border ${bg}">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center font-bold text-[10px] ${nameColor}">${coin.name.substring(0,3).toUpperCase()}</div>
                            <div>
                                <div class="font-bold text-sm ${nameColor}">${coin.name}</div>
                                <div class="text-[10px] ${color} font-bold">${signal.strength}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">RSI: ${signal.rsi.toFixed(0)}</div>
                            <div class="text-[9px] text-gray-500">TP: ${signal.tp1.toFixed(signal.price < 2 ? 4 : 2)}</div>
                        </div>
                    </div>`;
                } catch(e) {}
            }
            list.innerHTML = html;
        }

        // --- UTILS ---
        async function fetchCandles(symbol, interval) {
            const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=100`);
            const raw = await res.json();
            return raw.map(d => ({ close: parseFloat(d[4]), high: parseFloat(d[2]), low: parseFloat(d[3]) }));
        }

        function loadSettings() {
            const savedData = localStorage.getItem('cryptoApp_v3_settings');
            if (savedData) { const parsed = JSON.parse(savedData); state = { ...state, ...parsed }; updateRiskUI(state.riskMode); updateTFUI(state.tf); }
        }
        function saveSettings() { localStorage.setItem('cryptoApp_v3_settings', JSON.stringify(state)); }
        
        function renderCoinList() {
            const container = document.getElementById('coinList'); container.innerHTML = '';
            COINS.forEach((coin) => {
                const isActive = coin.symbol === state.currentSymbol;
                const isForex = coin.type === 'forex';
                
                const activeClass = isForex ? 'active-coin-forex border-yellow-500' : 'active-coin border-blue-500';
                const baseClass = isForex ? 'border-yellow-900/30 bg-yellow-900/10' : 'border-gray-700 bg-gray-800/40';
                
                const div = document.createElement('div');
                div.className = `min-w-[90px] p-2 rounded-xl border text-center cursor-pointer transition-all ${isActive ? activeClass : baseClass}`;
                div.onclick = () => { 
                    state.currentSymbol = coin.symbol; 
                    state.currentName = coin.name;
                    state.currentType = coin.type;
                    saveSettings(); renderCoinList(); analyzeMarket(); 
                };
                
                const textColor = isActive ? (isForex ? 'text-yellow-400' : 'text-white') : (isForex ? 'text-yellow-600' : 'text-gray-400');
                
                div.innerHTML = `<span class="text-xs font-bold ${textColor}">${coin.name}</span>`;
                container.appendChild(div);
            });
        }
        
        function setTF(tf) { state.tf = tf; updateTFUI(tf); saveSettings(); analyzeMarket(); }
        function updateTFUI(tf) { document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active-risk')); const btn = document.getElementById(`btn-${tf}`); if(btn) btn.classList.add('active-risk'); }
        function setRisk(mode) {
            let mult = 1.5; let name = 'Standard';
            if(mode === 'conservative') { mult = 2.5; name = 'Safe'; } if(mode === 'aggressive') { mult = 0.8; name = 'Degen'; }
            state.riskMode = mode; state.riskMultiplier = mult; state.riskName = name;
            updateRiskUI(mode); saveSettings(); analyzeMarket();
        }
        function updateRiskUI(mode) {
            document.querySelectorAll('.risk-btn').forEach(b => { b.classList.remove('active-risk', 'border-blue-500', 'bg-blue-500/20', 'text-white'); b.classList.add('border-gray-600', 'text-gray-400'); });
            const btn = document.getElementById(`risk-${mode}`); if(btn) { btn.classList.remove('border-gray-600', 'text-gray-400'); btn.classList.add('active-risk', 'border-blue-500', 'bg-blue-500/20', 'text-white'); }
        }
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden')); document.getElementById(`view-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(el => { el.classList.remove('active-nav', 'text-blue-500'); el.classList.add('text-gray-500'); });
            document.getElementById(`nav-${tabId}`).classList.remove('text-gray-500'); document.getElementById(`nav-${tabId}`).classList.add('active-nav');
            if(tabId === 'patterns') runScanner();
        }
    </script>
</body>
</html>
